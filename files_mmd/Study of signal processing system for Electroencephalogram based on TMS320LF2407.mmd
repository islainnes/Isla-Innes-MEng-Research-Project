# Study of Signal Processing System for Electroencephalogram based on TMS320LF2407

Zhihua Wang Xiaoli Quan Dayong Gong Chengbo Yu

School of Electronic Information and Automation, Chongqing Institute of Technology, Chongqing 400050,China

###### Abstract

As one of the weak signals' measurements, measuring Electroencephalogram (EEG) is very complicated. The preprocessed EEG contains much power interference and other high frequency noise, it can't be acquired unless those interferences are removed effectively. Through author's repetitions experimentation, it is proved that we can not only gain clear and clean Brainwave by using TMS320LF2407 but also invest less so the experiment is more convenient. According to the characteristic of Signal Processing System for EEG, this paper introduces two basic methods, the advantages and disadvantages of signal processing for EEG are compared, and also analyses the primary features of the DSP, especially TMS320LF2407.Besides,it expounds how to realize the hardware and the software of 16-channel signal processing system for EEG based on the TMS320LF2407.

 Electroencephalogram (EEG), Power Interference, Digital Signal Processing (DSP)

## I Introduction

The signal frequency of EEG is between 0.1Hz and 100Hz, and its amplitude is between 2uV and 200uV. As one of the weak signals' measurements, measuring Electroencephalogram (EEG) is extremely complicated. The processing of EEG has two ways: analog method or digital method. The early digital EEG's signal is almost entirely processed by analog circuit. The AD recording equipment or SCM transfers the processed data in up edge to show or mimeograph out. It is good in real-time working and easy realization in this way, but bad in anti-jamming feature and precision, it also need a big cubage electro circuit and easy to be effected by temperature. The digital processing of EEG is always realized by currency PC or SCM, it overcomes the disadvantage of the analog circuit, but it is not so well in real-time working feature1. So the DSP, which is good at real-time working, is used in EEG digital processing.

Footnote 1: Zhihua Wang : School of Electronic Information and Automation, Chongqing Institute of Technology, Chongqing 400050,China,

vanaszhihua@cuit.edu.cn

The digital signals processor (DSP), is an epoch-making product of TI company in 1980s. Compare with the normal SCM, DSP uses improved Harvard configuration, its instruction repertoire is pipelining, adopt an expert hard-multiplier and special DSP instruction. These characteristics have great improved the capability of DSP to deal with the mass data.

Internal new-style EEG amplifiers have begun to use DSP, but most of them use the 5000 series of TI company. This DSP chip has a very fast signal processing rate and well real-time working features, but it should work with CPLD or FPGA to control the external chips. Now the normal opinion is that the DSP of series 2000 suit to use in the numeral control but not treating, because its clock frequency is farther under the series 5000's, even more, it does not have a expert filter instruction. But to the EEG, its signal frequency is lower than 100Hz and is regarded as a kind of low frequency signal. So for digital processing, the data size is acceptable. As 16-channel data operation for EEG signal, if the sampling frequency is 1000Hz for each channel, system should accomplish sampling, operation and data transmission in 62.5uS for each sampling point. The TMS320LF2407 DSP we used in experiment, could satisfy the requirement in operation rate, more ever, it is pre-dominances in price and expandability.

TMS320LF2407 DSP is a special current DSP chip of TI company which is working under TMS320C2000TM flat roof. It adopts high performance CMOS technology, the power supply voltage is lowered to 3.3 V, lowing down the power consumption of controller. The fastest processing speed is 40MIPS which shows a good digital signals real time controlling and treating ability. The 34K capability make it is convenient to write the code into the flash program memory. 40 current in/out pins which could be separated programmed or multiple-used, can expend multiple parallel external equipments. TMS320LF2407DSP mixed the microcontroller and microprocessor, can be reliably used in multi-channel biologic electrical signal digital processing system.

## II System Hardware Design

The TMS320LF2407DSP is the hard-core of the hardware, used as the controller and digital signal processor. The external circuit is made up of by 16bit AD converter, external memorizer, USB100 module, 12bit DA converter, 8bit indicator light, digital optoelectronic isolator. The hardware system chart is just as Fig. 1.

The analog-to-digital sampled 16 channel EEG signals which come from pre-amplification circuit transfers into the DSP central processing unit to digital filtering, and then transferred the operated data upside through USB100 module. In debugging, we could observe the digital processed EEG from the oscillograph by the DA converter. 8bit indicator light is be used to check the clock rate in debugging.

Although there are integrated 16 channels AD convertor inside TMS320LF1407, the precision is only 10 bit, the minimum differentiating value of brain electric signal voltage is 3mV. But in order to prevent differential mode interference becoming saturation at the output end, the magnification times of the prestage amplification circuit in the data acquisition system usually set to 50, the minimum EEG signal amplitude value can be amplified to 0.5mV. By all appearance 10 bit precision of AD convertor is not enough. In this system, 165KSPS slew rate, 16 bit high precision AD convertor MAX1165 which is made by Maxim Company is used, the minimum differentiating voltage value of it is 62.5mV, completely satisfied the precision requirement of this system[5].

TMS320LF2407 possessed 64KB program memory space and 64KB date memory space, 32k FLASH program memory inside. Commonly after program debugging finished, we write the executable program code into FLASH by download line and CCS software to let the program run from 0000H when current supplied, complete the control function we need. In program debugging, the external expansion memory is used as a program memory to put program code which is used for emulation, but when the program is running disengaged the emulator, it can be set as data memory to add data storage ability.

EEG signal data, first AD transformed and then operated by digital filter, finally upload to PC in order to display brain waveform and saved or printed in real-time. For the brain wave's sampling frequency for each channel is 1000Hz and 16 bit data precision, the transformation rate of EEG should be faster than 256bit/s. But the rate of serial port is only 19.2bit/s, to fit the transformation rate between up and down side without increasing the system difficulty, we use USB100 module, which's transformation rate is 8Mbit/s, as the communication interface to connect DSP and upside.

This system use levitation differential amplify mode at the front end to separate human body and electric for safety. Use optoelectronic isolate technology to prevent the mutual disturbance current of digital circuit and artificial circuit flowing through the ground wire. The optoelectronic isolate technology is that, using artificial optoelectronic isolator to connect the fan-out of artificial switch and the digital circuit, using digital optoelectronic isolators to connect the 4 gated address wire and the multiple-used I/O ports of DSP, gating 16-channel by DSP, consequently cut off the disturbance between digital circuit and artificial circuit.

The interface circuits of DSP to12bit DA convertor and to 8bit indicator light are just as the circuit of DSP to AD convertor, they are all addressing by I/O ports, data transform by OUT dictation. Be omitted here.

Every portion of the hardware system have closely mutuality with each other, the capability of signal processing system for EEG is direct lie on the hardware design.

## III System Software Design

The software of EEG digital signal processing is buildup by math.h, register.h, LF2407.CMD, RTS2XX.LIB, cvectors.asm, process.c. In these 6 parts, math.h is the math data base file which will be used in program, register.h is the CPU inner register and correlated defining file, LF2407.CMD is the connecting order file, which direct the compiler how to dispense the room to program space and data space, RTS2XX.LIB is a system afforded library file, cvectors.asm is a vector list file, which define the resetting and breaking vector, process.c is the hard core of this system, which is used in achieving the user's need as its major.

The mainly assignments of process.c are 16-channel EEG signal AD converting, digital filter, uploading data through USB interface. The main program flow block graph of process.c is just as Fig. 2.

The program operating sequence of DSP is that:

1. Reset DSP while electriving.
2. Program go to main enter address based on the interrupt vector list.
3. Main program turn off the interrupt.
4. Initialize the system, AD converter and the USB100 module. Set the AD converter at Time4 interrupting triggering AD convert, start watchdog, enable the interrupt.
5. Main program judges whether the AD converting process has be finished:

if the AD converting process has not be finished, then waiting for it.

if the AD converter have be finished, read the ratio, and then digital filtering by using digital filtering subprogram.

Fig.1: Hardware System Chart6) Upload the output result and then waiting for the next converted data

AD converting is started by AD interrupting serving subprogram. In this subprogram, start AD converting, and then set the AD converted successful sign to call the main program to read the data and digital filter. The interrupting serving subprogram is showed by picture 3.

In this program, the hard-core is IIR digital filtering subprogram, which is realized by IIR digital filter designed by MATLAB. It could be expressed by this in&out-put sequence.

\[y(n)=b_{0}x(n)+b_{1}x(n-1)+b_{2}x(n-2)\mathrm{L}\ +\] \[b_{n}x(0)-a_{1}y(n-1)-a_{2}y(n-2)-\mathrm{L}\ -a_{n}y(0)\]

From the IIR digital filtering expression we can see that, current digital filtering subprogram need these parameter: input sequence \(x(n)\), filtering coefficient of the input sequence \(b_{(n)}\), product item coefficient of the inputsequence nl, output sequence \(y(n)\), filtering coefficient of the output sequence \(a_{(n)}\), product item coefficient of the output sequence nl-1, and the last input \(x(n)\), comes from filtering channel n.

The upside digital filtering process is that, read the input sequence \(x(n)\), from corresponding filtering channel as the first step, and then separate sum the product item of the input&output sequence, the last step, the repeated summation of these sums is the output sequence \(y(n)\), of this time. In filtering process, to prevent filtering unsteadiness, we clip the output sequence: because the maximum output of 16bit AD converting is 65536, so that the digital filtered output sequence \(y(n)\) must be less than 65536. For it is a real-time digital filter, so after this time's digital filtering, we should modulate the input sequence, that is putting the \(x(i+1)\) to \(x(i)\) for the next digital filtering process. In like manner, \(y(i+1)\) would be put to \(y(i)\) when sequence \(y(n)\) has be output.

The next is the EEG wave getting from upper course

Fig. 3: Flow Block Graph of the Interrupting Serving Subprogram

Fig. 2: Main program Flow Block GraphIn the picture upside, we can see that, the 50Hz power interference and other high frequency interference have been well inhibited. Salted doctor can distinguish the kind of EEG and judge the testee's pathology condition with out signal retreatment in upstream system.

## IV Conclusion

In the process of 16-channel EGG signal amplifier development, EEG signal processing system is the all-important constituent part. In this paper, the digital signal processor system which is based on TMS320LF2407 DSP shows great effectiveness in the design stage of EEG. As this production, we can see that reasonable use the DSP could greatly improve the instrument capability. TMS320LF2407 does not only strut its stuff in the field of electric machine control for its strong control function, but also handy in signal processing base on its enhancement Harvard configuration and pipeline organization. It is indeed that the operational speed of DSP 2000 is finite, in mass data operation or image treating, the DSP of series 5000 or 6000 is much suitable, but compare with the common SCM, TMS320LF2407 has a great advantage in 16-channel digital processing for EEG, it could be expected that the TMS320LF2407 will be widely used in the biomedical electric signal measurement.

## References

* [1] Yu XueEi, The Theory and Design of Medical Electronic Machine, Guang zhou, The Publishing Company of Southern Chinese Science and Technology University, Mar.2000.
* [2] Xiao Zhongqiang, Meng Kaiyuan, The Theory of Data Collecting, Xi an, The Publishing Company of Northwest Chinese Industrial University, Feb. 2001.
* [3] Zhu Minggao, Zhao Yong, The Design of DSP Applied System, Electronic Industrial Publishing Company, Oct. 2002.
* [4] Liu Heping, Yan Liping, The Configuration, Theory and Application of TMS320LF240XDSP, The Publishing Company of Pekin Aviation and Spaceflight University, Apr. 2002.
* [5] Zhao Futu, IC Enchirtion of Signal Collection and Process, Chymic Industrial Publishing Company, Sep. 2002.
* [6] Li Chaosing, Peripheral Digital IC Technologie Enchirtion of SCM and DSP, The Publishing Company of Pekin Aviation and Spaceflight University, Jan. 2003.

Fig. 4: Digital Processed EEG Wave